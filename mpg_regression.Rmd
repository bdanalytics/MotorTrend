---
# Get YAML keywords from myYAML_ref.Rmd
title: "Motor Trend: mpg regression"
author: "bdanalytics"
#output: html_document
---
#### Date: `r format(Sys.time(), "(%a) %b %d, %Y")`

Data: Motor Trend Car Road Tests "mtcars {datasets}"  
Source: Henderson and Velleman (1981), Building multiple regression models interactively. Biometrics, 37, 391–411.  
Time period: 1973–74 models

### Synopsis:

#### Is an automatic or manual transmission better for MPG:
Manual transmission is better for miles per gallon versus automatic transmission.  
Average mpg for automatic transmission is `17` vs. `23` for manual transmission.  

#### Quantify the MPG difference between automatic and manual transmissions:
Manual Transmission provides `7.2449` additional miles per gallon compared to automatic transmission. This result is highly significant - 95% confidence interval is `[3.6415, 10.8484]`

#### Potential next steps include:
0. Inspect residuals by features not used in model
1. Adjust model for residual heteroskedacity
2. Test other models to better quantify the relationship (confounding factors)

```{r set_global_options}
rm(list=ls())
set.seed(12345)
source("~/Dropbox/datascience/R/mydsutils.R")
source("~/Dropbox/datascience/R/myplot.R")
# Gather all package requirements here
#suppressPackageStartupMessages(require())
```

```{r set_global_options_wd, echo=FALSE}
setwd("~/Documents/Work/Courses/Coursera/jhu-datascience/G-Regression-Models/Project/MotorTrend")
```

### Step 01: import data
```{r import_data, cache=TRUE}
data(mtcars)
cars_df <- mtcars
myprint_df(cars_df)
```

#### Step 02.1: inspect data
Automtatic Transmission feature (am) is numeric. Let's make it a factor for analytics convenience.
```{r inspect_steps_1, cache=TRUE}
cars_df$am_fctr <- factor(cars_df$am, labels=c("automatic", "manual"))
print(str(cars_df))

#[, 1]  mpg	    Miles/(US) gallon
#[, 2]	cyl	    Number of cylinders
#[, 3]	disp	Displacement (cu.in.)
#[, 4]	hp	    Gross horsepower
#[, 5]	drat	Rear axle ratio
#[, 6]	wt	    Weight (lb/1000)
#[, 7]	qsec	1/4 mile time
#[, 8]	vs	    V/S
#[, 9]	am	    numeric:    Transmission (0 = automatic, 1 = manual)
#[,12]  am_fctr	factor:     Transmission (automatic, manual)
#[,10]	gear	Number of forward gears
#[,11]	carb	Number of carburetors

print(summary(cars_df))
#pairs(subset(entity_df, select=-c(col_symbol)))

print(myplot_violin(cars_df, "mpg", "am_fctr"))

# Create new features that help diagnostics
```

#### Is an automatic or manual transmission better for MPG:
Null Hypothesis ($\sf{H_{0}}$): mpg is not impacted by am_fctr.  
The variance by am_fctr appears to be independent. 
```{r q1, cache=TRUE}
print(t.test(subset(cars_df, am_fctr == "automatic")$mpg, 
             subset(cars_df, am_fctr == "manual")$mpg, 
             var.equal=FALSE)$conf)
```
We reject the null hypothesis i.e. we have evidence to conclude that am_fctr impacts mpg (95% confidence). Manual transmission is better for miles per gallon versus automatic transmission.

#### Quantify the MPG difference between automatic and manual transmissions:
```{r q2_1, cache=TRUE}
mpg_fit <- lm(mpg ~ am_fctr, data=cars_df)
print(summary(mpg_fit))
```
Manual Transmission provides ``r mpg_fit$coeff[2]`` additional miles per gallon compared to automatic transmission. This result is highly significant - 95% confidence interval is `[`r confint(mpg_fit)[2, ]`]`. About ``r round(summary(mpg_fit)$r.squared * 100, 2)``% of the mpg variance is attributable to transmission.

```{r q2_2, cache=TRUE}
#print(myplot_scatter(cars_df, "am_fctr", "mpg", colorcol_name="am_fctr"))

mpg_residuals_df <- data.frame(mpg_fit$residuals, cars_df$mpg, cars_df$am_fctr)
#print(summaryBy(mpg_fit.residuals ~ cars_df.am_fctr, data=mpg_residuals_df, FUN=mean))
print(myplot_violin(mpg_residuals_df, "mpg_fit.residuals", "cars_df.am_fctr"))

#print(myplot_scatter(mpg_residuals_df, "cars_df.am_fctr", "mpg_fit.residuals", 
#                     colorcol_name="cars_df.am_fctr"))
```  
The residuals of the regression does not appear biased with mean close to `0`. However, there is some minor residual heteroskedacity. 

```{r print_sessionInfo, echo=FALSE}
sessionInfo()
```